<!DOCTYPE busconfig PUBLIC
 "-//freedesktop//DTD D-Bus Bus Configuration 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
<busconfig>
  <!-- Container system bus configuration.
       Based on the standard system.conf with power management blocked.
       Uses deny-by-default policy; per-package .conf files in system.d/
       punch holes for specific services (PackageKit, NetworkManager, etc). -->

  <type>system</type>

  <user>messagebus</user>
  <listen>unix:path=/var/run/dbus/system_bus_socket</listen>

  <auth>EXTERNAL</auth>

  <standard_system_servicedirs/>
  <servicehelper>/usr/lib/dbus-1.0/dbus-daemon-launch-helper</servicehelper>

  <!-- Default policy: deny-by-default, matching standard system.conf.
       Per-package files in system.d/ grant access to specific services. -->
  <policy context="default">
    <allow user="*"/>

    <!-- Deny ownership and method calls by default;
         per-package .conf files in system.d/ open these up -->
    <deny own="*"/>
    <deny send_type="method_call"/>

    <!-- Signals and replies are allowed by default -->
    <allow send_type="signal"/>
    <allow send_requested_reply="true" send_type="method_return"/>
    <allow send_requested_reply="true" send_type="error"/>

    <!-- All messages may be received by default -->
    <allow receive_type="method_call"/>
    <allow receive_type="method_return"/>
    <allow receive_type="error"/>
    <allow receive_type="signal"/>

    <!-- Allow anyone to talk to the message bus -->
    <allow send_destination="org.freedesktop.DBus"
           send_interface="org.freedesktop.DBus"/>
    <allow send_destination="org.freedesktop.DBus"
           send_interface="org.freedesktop.DBus.Introspectable"/>
    <allow send_destination="org.freedesktop.DBus"
           send_interface="org.freedesktop.DBus.Properties"/>
    <allow send_destination="org.freedesktop.DBus"
           send_interface="org.freedesktop.DBus.Containers1"/>
    <deny send_destination="org.freedesktop.DBus"
          send_interface="org.freedesktop.DBus"
          send_member="UpdateActivationEnvironment"/>
    <deny send_destination="org.freedesktop.DBus"
          send_interface="org.freedesktop.DBus.Debug.Stats"/>
    <deny send_destination="org.freedesktop.DBus"
          send_interface="org.freedesktop.systemd1.Activator"/>
  </policy>

  <!-- Root policies from standard system.conf -->
  <policy user="root">
    <allow send_destination="org.freedesktop.DBus"
           send_interface="org.freedesktop.systemd1.Activator"/>
    <allow send_destination="org.freedesktop.DBus"
           send_interface="org.freedesktop.DBus.Monitoring"/>
    <allow send_destination="org.freedesktop.DBus"
           send_interface="org.freedesktop.DBus.Debug.Stats"/>
  </policy>

  <!-- Load per-package policy files (PackageKit, NetworkManager, etc).
       These punch holes in the deny-by-default policy above. -->
  <includedir>system.d</includedir>
  <includedir>/etc/dbus-1/system.d</includedir>

  <!-- Power management restrictions applied AFTER per-package includes
       so they override any allows from package policy files (last match wins). -->
  <policy context="default">
    <!-- Block systemd power actions -->
    <deny send_destination="org.freedesktop.systemd1"
          send_interface="org.freedesktop.systemd1.Manager"
          send_member="PowerOff"/>
    <deny send_destination="org.freedesktop.systemd1"
          send_interface="org.freedesktop.systemd1.Manager"
          send_member="Reboot"/>
    <deny send_destination="org.freedesktop.systemd1"
          send_interface="org.freedesktop.systemd1.Manager"
          send_member="Suspend"/>
    <deny send_destination="org.freedesktop.systemd1"
          send_interface="org.freedesktop.systemd1.Manager"
          send_member="Hibernate"/>
    <deny send_destination="org.freedesktop.systemd1"
          send_interface="org.freedesktop.systemd1.Manager"
          send_member="HybridSleep"/>

    <!-- Block login1 power actions -->
    <deny send_destination="org.freedesktop.login1"
          send_interface="org.freedesktop.login1.Manager"
          send_member="PowerOff"/>
    <deny send_destination="org.freedesktop.login1"
          send_interface="org.freedesktop.login1.Manager"
          send_member="Reboot"/>
    <deny send_destination="org.freedesktop.login1"
          send_interface="org.freedesktop.login1.Manager"
          send_member="Suspend"/>
    <deny send_destination="org.freedesktop.login1"
          send_interface="org.freedesktop.login1.Manager"
          send_member="Hibernate"/>
    <deny send_destination="org.freedesktop.login1"
          send_interface="org.freedesktop.login1.Manager"
          send_member="HybridSleep"/>

    <!-- Block power management services entirely -->
    <deny send_destination="org.freedesktop.UPower"/>
    <deny own="org.freedesktop.UPower"/>
    <deny send_destination="net.hadess.PowerProfiles"/>
    <deny own="net.hadess.PowerProfiles"/>
    <deny send_destination="org.gnome.PowerManager"/>
    <deny own="org.gnome.PowerManager"/>
    <deny send_destination="org.gnome.SessionManager.Presence"/>
    <deny own="org.gnome.SessionManager.Presence"/>
    <deny send_destination="org.kde.powerdevil"/>
    <deny own="org.kde.powerdevil"/>
    <deny send_destination="org.kde.Solid.PowerManagement"/>
    <deny own="org.kde.Solid.PowerManagement"/>
    <deny send_destination="org.freedesktop.thermald"/>
    <deny own="org.freedesktop.thermald"/>
    <deny send_destination="org.laptop_mode.tools"/>
    <deny own="org.laptop_mode.tools"/>
    <deny send_destination="com.intel.dptf"/>
    <deny own="com.intel.dptf"/>
  </policy>

  <!-- Block power management even for root -->
  <policy user="root">
    <deny own="org.freedesktop.UPower"/>
    <deny own="net.hadess.PowerProfiles"/>
    <deny send_destination="org.freedesktop.login1"
          send_interface="org.freedesktop.login1.Manager"
          send_member="PowerOff"/>
    <deny send_destination="org.freedesktop.login1"
          send_interface="org.freedesktop.login1.Manager"
          send_member="Reboot"/>
    <deny send_destination="org.freedesktop.login1"
          send_interface="org.freedesktop.login1.Manager"
          send_member="Suspend"/>
    <deny send_destination="org.freedesktop.login1"
          send_interface="org.freedesktop.login1.Manager"
          send_member="Hibernate"/>
  </policy>

</busconfig>